# SynOSX · FloatLog / Audit Log 浮动窗设计想法（总结稿）

> 目标：把 “Audit / Runtime Log” 做成**系统级浮动窗（Floating Inspector / Floating Panel）**，用于展示可回放的治理证据链日志。  
> 核心体验：**默认可见、可拖拽、可关闭、可滑到边缘收起（Dock）**，需要时再从边缘把它拉回来。

---

## 1. 你现在这套设计叫什么

你要的不是 Drawer（抽屉），也不是 Modal（遮罩弹窗），而是：

- **Floating Panel / Floating Inspector（浮动检查器面板）**
- 带 **Docking / Edge Dock（边缘停靠/收起）**
- 带 **Drag-to-move（拖拽移动）**
- 带 **Close（关闭 X）**
- 可选：Collapse（折叠，只保留标题条）

一句话：**可拖动、可停靠、可随时隐藏/召回的浮动日志检查器**。

---

## 2. 你明确的交互规则（你要的效果）

### A. 默认状态（最重要）
- **默认显示“内容框”**（日志面板本体在屏幕上）。
- 不是默认只显示边缘把手（那个 “>” 按钮）。
- 用户打开页面就能看到：这是一个“运行时证据窗”，不是隐藏功能。

### B. 关闭按钮（右上角 X）
- 面板右上角提供 **X**（关闭）。
- 点击 X：面板隐藏，并进入“已收起”状态（Dock / Handle 允许出现）。

### C. 拖拽移动（电脑端 & 手机端）
- 面板可以被拖拽到任意位置（通常抓取标题栏拖拽）。
- 需要处理：
  - 电脑端：mouse / pointer 拖拽
  - 移动端：touch / pointer 拖拽

### D. 推到边缘隐藏（Dock）
- **用户用手把面板推到屏幕右边或左边**时：
  - 面板自动“贴边停靠”
  - 面板本体隐藏
  - **只留下边缘的小把手（handle）**
- 用户点击/拖动把手：面板再次展开回到上次位置。

> 关键点：**把手只在收起后出现**，不是默认出现。

### E. 日志的出现逻辑
- 点击 “Trace ID 交互示例（点击模拟回放）”：
  - 应当触发浮动窗打开（若已收起则展开）
  - 清空并写入模拟日志
  - 不应该出现“按了没反应”的体验

---

## 3. 你不想要的东西（明确禁止）

- ❌ 默认显示边缘把手、内容窗消失（你骂的就是这个）
- ❌ 只能点一下弹出、看完自动消失（像 toast）
- ❌ Drawer 抽屉（从侧边推出来但不可自由移动）
- ❌ 需要滚动到某个位置才能看到面板

---

## 4. 文件职责（你在项目里的合理分工）

你目前的目标是把浮动日志“制度化”，所以建议职责这样划分：

### sx.floatlog.css
- 只负责**外观与布局**：
  - 浮动窗尺寸、边框、阴影、玻璃质感
  - 标题栏、按钮（X / Collapse）
  - Dock 后的 handle 外观
  - 响应式规则（移动端尺寸、触控热区）

### sx.floatlog.js
- 只负责**系统级交互能力**（所有页面可复用）：
  - open / close / collapse
  - drag-to-move
  - dock-to-edge（推到边缘收起）
  - handle 召回
  - 提供 append / clear / setTitle 之类 API 给各页面 runtime 调用

### index.runtime.js（或 page runtime）
- 只负责**业务行为**：
  - 点击 Trace ID 时写哪些 log
  - 跳转 replay.html 时写哪些提示
  - 不负责 UI 能力（不应该自己再造一套拖拽逻辑）

---

## 5. 你提到的按钮：需要这个 X 吗？

需要。理由很简单：
- Dock 是“手势式隐藏”，X 是“明确关闭”
- 两者解决的是不同用户习惯
- X 还能在桌面端替代手势（更直观）

**结论：X 是必需的，且在内容窗上方右侧。**

---

## 6. 你当前遇到的主要问题（诊断总结）

1. **默认展示状态错了**：你要默认“内容窗”，但现在默认“把手/空白”。
2. **触发链断了**：点击 Trace ID 没有可靠地触发 open + 写日志（所以你看到“按了没反应”）。
3. **结构/引入重复**：HTML 里 handle、css、js 被重复插入会导致绑定错位或样式覆盖混乱。
4. **移动端布局**：面板/页面布局在 mobile 上可能被 overflow/定位规则吞掉，需要明确 mobile 策略。

---

## 7. 成功验收标准（你可以用它一眼判断对不对）

- 打开页面：**浮动窗默认可见**（不是 handle）。
- 点击 Trace ID：日志立刻开始刷，面板自动聚焦显示。
- 拖拽标题栏：面板能移动。
- 推到屏幕边缘：面板收起，出现 handle。
- 点击 handle：面板回来。
- 点击右上角 X：面板关闭并只留下 handle（或完全隐藏，按你制度选择）。
